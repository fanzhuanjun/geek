# 数据导入与整理


```python
import pandas as pd
import numpy as np
import os
```


```python
import matplotlib.pyplot as plt

# 中文乱码
plt.rcParams['font.sans-serif']=['SimHei'] #用来正常显示中文标签
plt.rcParams['axes.unicode_minus']=False #用来正常显示负号
```


```python
list_stock = os.listdir("异象/")
list_stock
```




    ['1个月波动率.xlsx',
     'PE.xlsx',
     '净经营现金流.xlsx',
     '市现率.xlsx',
     '总资产.xlsx',
     '总资产增幅年.xlsx',
     '收益率.xlsx',
     '毛利.xlsx',
     '营业利润.xlsx',
     '销售费用.xlsx']




```python
len(list_stock)
```




    10




```python
def get_final_data(path):
    df = pd.read_excel("异象/" + path)
    df.columns = list(df.loc[1].values)
    df = df.drop([0, 1]).T.reset_index().copy()
    df.columns = df.loc[0]
    
    df = df.drop(0, axis=0)
    _ = df.set_index(['日期', 'Date']).stack(dropna=False)
    _.name = path.split('.')[0]
    _ = _.reset_index()
    
    _.columns = ['证券名称', '证券代码', '日期', path.split('.')[0]]
    
    return _
```


```python
df_final = get_final_data(list_stock[0])
for i in range(1, len(list_stock)):
    _ = get_final_data(list_stock[i])
    df_final = df_final.merge(_, on=['证券名称', '证券代码', '日期'], how='outer')
    print(i, list_stock[i])
```

    1 PE.xlsx
    2 净经营现金流.xlsx
    3 市现率.xlsx
    4 总资产.xlsx
    5 总资产增幅年.xlsx
    6 收益率.xlsx
    7 毛利.xlsx
    8 营业利润.xlsx
    9 销售费用.xlsx
    


```python
df_final.columns
```




    Index(['证券名称', '证券代码', '日期', '1个月波动率', 'PE', '净经营现金流', '市现率', '总资产', '总资产增幅年',
           '收益率', '毛利', '营业利润', '销售费用'],
          dtype='object')




```python
for col in ['1个月波动率', 'PE', '净经营现金流', '市现率', '总资产', '总资产增幅年',
       '毛利', '营业利润', '销售费用', '收益率']:
    print(col)

    df_final[col] = df_final[col].astype("str").replace("NaT", np.nan).astype("float")
```

    1个月波动率
    PE
    净经营现金流
    市现率
    总资产
    总资产增幅年
    毛利
    营业利润
    销售费用
    收益率
    


```python
df_final.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 908880 entries, 0 to 908879
    Data columns (total 13 columns):
     #   Column  Non-Null Count   Dtype         
    ---  ------  --------------   -----         
     0   证券名称    908880 non-null  object        
     1   证券代码    908880 non-null  object        
     2   日期      908880 non-null  datetime64[ns]
     3   1个月波动率  472692 non-null  float64       
     4   PE      458660 non-null  float64       
     5   净经营现金流  572767 non-null  float64       
     6   市现率     472799 non-null  float64       
     7   总资产     455794 non-null  float64       
     8   总资产增幅年  48339 non-null   float64       
     9   收益率     473111 non-null  float64       
     10  毛利      469165 non-null  float64       
     11  营业利润    577579 non-null  float64       
     12  销售费用    555770 non-null  float64       
    dtypes: datetime64[ns](1), float64(10), object(2)
    memory usage: 97.1+ MB
    


```python
df_final
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>证券名称</th>
      <th>证券代码</th>
      <th>日期</th>
      <th>1个月波动率</th>
      <th>PE</th>
      <th>净经营现金流</th>
      <th>市现率</th>
      <th>总资产</th>
      <th>总资产增幅年</th>
      <th>收益率</th>
      <th>毛利</th>
      <th>营业利润</th>
      <th>销售费用</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>浦发银行</td>
      <td>600000.SH</td>
      <td>2000-01-28</td>
      <td>0.113090</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-20.740217</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.171717</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>浦发银行</td>
      <td>600000.SH</td>
      <td>2000-02-29</td>
      <td>0.214095</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-20.847895</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.519169</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>浦发银行</td>
      <td>600000.SH</td>
      <td>2000-03-31</td>
      <td>0.051750</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31.358698</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.198649</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>浦发银行</td>
      <td>600000.SH</td>
      <td>2000-04-28</td>
      <td>0.021253</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31.085148</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.872324</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>浦发银行</td>
      <td>600000.SH</td>
      <td>2000-05-31</td>
      <td>0.052280</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>29.157869</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-6.200000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>908875</th>
      <td>铂科新材</td>
      <td>300811.SZ</td>
      <td>2019-08-30</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.117366</td>
      <td>NaN</td>
      <td>3.419308</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.651387</td>
      <td>0.085886</td>
    </tr>
    <tr>
      <th>908876</th>
      <td>铂科新材</td>
      <td>300811.SZ</td>
      <td>2019-09-30</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.351393</td>
      <td>NaN</td>
      <td>5.478271</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.981739</td>
      <td>0.113446</td>
    </tr>
    <tr>
      <th>908877</th>
      <td>铂科新材</td>
      <td>300811.SZ</td>
      <td>2019-10-31</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.351393</td>
      <td>NaN</td>
      <td>5.478271</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.981739</td>
      <td>0.113446</td>
    </tr>
    <tr>
      <th>908878</th>
      <td>铂科新材</td>
      <td>300811.SZ</td>
      <td>2019-11-29</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.351393</td>
      <td>NaN</td>
      <td>5.478271</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.981739</td>
      <td>0.113446</td>
    </tr>
    <tr>
      <th>908879</th>
      <td>铂科新材</td>
      <td>300811.SZ</td>
      <td>2019-12-31</td>
      <td>NaN</td>
      <td>28.969932</td>
      <td>0.482753</td>
      <td>-723.363403</td>
      <td>9.238139</td>
      <td>84.751939</td>
      <td>10.010593</td>
      <td>1.624484</td>
      <td>0.983576</td>
      <td>0.122417</td>
    </tr>
  </tbody>
</table>
<p>908880 rows × 13 columns</p>
</div>




```python
len(df_final.columns)
```




    13




```python
df_final.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 908880 entries, 0 to 908879
    Data columns (total 13 columns):
     #   Column  Non-Null Count   Dtype         
    ---  ------  --------------   -----         
     0   证券名称    908880 non-null  object        
     1   证券代码    908880 non-null  object        
     2   日期      908880 non-null  datetime64[ns]
     3   1个月波动率  472692 non-null  float64       
     4   PE      458660 non-null  float64       
     5   净经营现金流  572767 non-null  float64       
     6   市现率     472799 non-null  float64       
     7   总资产     455794 non-null  float64       
     8   总资产增幅年  48339 non-null   float64       
     9   收益率     473111 non-null  float64       
     10  毛利      469165 non-null  float64       
     11  营业利润    577579 non-null  float64       
     12  销售费用    555770 non-null  float64       
    dtypes: datetime64[ns](1), float64(10), object(2)
    memory usage: 97.1+ MB
    


```python
df_final_drop = df_final[df_final['收益率'].notnull()]
```


```python
df_final_drop.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 473111 entries, 0 to 908879
    Data columns (total 13 columns):
     #   Column  Non-Null Count   Dtype         
    ---  ------  --------------   -----         
     0   证券名称    473111 non-null  object        
     1   证券代码    473111 non-null  object        
     2   日期      473111 non-null  datetime64[ns]
     3   1个月波动率  472692 non-null  float64       
     4   PE      458660 non-null  float64       
     5   净经营现金流  468258 non-null  float64       
     6   市现率     472799 non-null  float64       
     7   总资产     361420 non-null  float64       
     8   总资产增幅年  39674 non-null   float64       
     9   收益率     473111 non-null  float64       
     10  毛利      467489 non-null  float64       
     11  营业利润    468868 non-null  float64       
     12  销售费用    456367 non-null  float64       
    dtypes: datetime64[ns](1), float64(10), object(2)
    memory usage: 50.5+ MB
    


```python
df_final_fill = df_final_drop.copy()
```


```python
df_final_fill['1个月波动率'] = df_final_fill.groupby("证券代码")['1个月波动率'].fillna(method='ffill')
df_final_fill['PE'] = df_final_fill.groupby("证券代码")['PE'].fillna(method='ffill')
df_final_fill['净经营现金流'] = df_final_fill.groupby("证券代码")['净经营现金流'].fillna(method='ffill')
df_final_fill['市现率'] = df_final_fill.groupby("证券代码")['市现率'].fillna(method='ffill')
df_final_fill['总资产'] = df_final_fill.groupby("证券代码")['总资产'].fillna(method='ffill')
df_final_fill['总资产增幅年'] = df_final_fill.groupby("证券代码")['总资产增幅年'].fillna(method='ffill')
df_final_fill['毛利'] = df_final_fill.groupby("证券代码")['毛利'].fillna(method='ffill')
df_final_fill['营业利润'] = df_final_fill.groupby("证券代码")['营业利润'].fillna(method='ffill')
df_final_fill['销售费用'] = df_final_fill.groupby("证券代码")['销售费用'].fillna(method='ffill')
```


```python
df_final_fill['销售费用/总资产'] = df_final_fill['销售费用'] / df_final_fill['总资产']
df_final_fill['EP'] = 1 / df_final_fill['PE']
df_final_fill['毛利润资产比'] = df_final_fill['毛利'] / df_final_fill['总资产']
df_final_fill['应计利润'] = df_final_fill['营业利润'] - df_final_fill['净经营现金流'] / df_final_fill['总资产']
```


```python
df_final_fill['日期'] = pd.to_datetime(df_final_fill['日期'])
```


```python
df_final_fill.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 473111 entries, 0 to 908879
    Data columns (total 17 columns):
     #   Column    Non-Null Count   Dtype         
    ---  ------    --------------   -----         
     0   证券名称      473111 non-null  object        
     1   证券代码      473111 non-null  object        
     2   日期        473111 non-null  datetime64[ns]
     3   1个月波动率    472692 non-null  float64       
     4   PE        458660 non-null  float64       
     5   净经营现金流    468258 non-null  float64       
     6   市现率       472799 non-null  float64       
     7   总资产       361420 non-null  float64       
     8   总资产增幅年    435817 non-null  float64       
     9   收益率       473111 non-null  float64       
     10  毛利        467489 non-null  float64       
     11  营业利润      468868 non-null  float64       
     12  销售费用      456367 non-null  float64       
     13  销售费用/总资产  352300 non-null  float64       
     14  EP        458660 non-null  float64       
     15  毛利润资产比    356271 non-null  float64       
     16  应计利润      361401 non-null  float64       
    dtypes: datetime64[ns](1), float64(14), object(2)
    memory usage: 65.0+ MB
    

## 分组


```python
yixiang_cols = ['总资产增幅年', '销售费用/总资产', 'EP', '毛利润资产比', '应计利润']
```


```python
df_final_fill[yixiang_cols].info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 473111 entries, 0 to 908879
    Data columns (total 5 columns):
     #   Column    Non-Null Count   Dtype  
    ---  ------    --------------   -----  
     0   总资产增幅年    435817 non-null  float64
     1   销售费用/总资产  352300 non-null  float64
     2   EP        458660 non-null  float64
     3   毛利润资产比    356271 non-null  float64
     4   应计利润      361401 non-null  float64
    dtypes: float64(5)
    memory usage: 21.7 MB
    

## 每期T使用以上指标单变量排序 分为10组 最大组收益率减最小组收益率作为 ，做出累计收益率图像


```python
# 分组出错的原因！！！！
for col in yixiang_cols:
    _ = df_final_fill.groupby("日期")[col].count().head(25)
    print(_)
```

    日期
    2000-01-28       0
    2000-02-29       0
    2000-03-31       0
    2000-04-28       0
    2000-05-31       0
    2000-06-30       0
    2000-07-31       0
    2000-08-31       0
    2000-09-29       0
    2000-10-31       0
    2000-11-30       0
    2000-12-29       0
    2001-01-19       0
    2001-02-28       0
    2001-03-30       0
    2001-04-30       0
    2001-05-31       0
    2001-06-29       0
    2001-07-31       0
    2001-08-31       0
    2001-09-28       0
    2001-10-31       0
    2001-11-30       0
    2001-12-31    1033
    2002-01-31    1033
    Name: 总资产增幅年, dtype: int64
    日期
    2000-01-28     0
    2000-02-29     0
    2000-03-31     0
    2000-04-28     0
    2000-05-31     0
    2000-06-30     0
    2000-07-31     0
    2000-08-31     0
    2000-09-29     0
    2000-10-31     0
    2000-11-30     0
    2000-12-29     0
    2001-01-19     0
    2001-02-28     0
    2001-03-30     0
    2001-04-30     0
    2001-05-31     0
    2001-06-29     0
    2001-07-31     0
    2001-08-31     0
    2001-09-28     0
    2001-10-31     0
    2001-11-30     0
    2001-12-31    23
    2002-01-31    24
    Name: 销售费用/总资产, dtype: int64
    日期
    2000-01-28      1
    2000-02-29      2
    2000-03-31      3
    2000-04-28      4
    2000-05-31      4
    2000-06-30      4
    2000-07-31      4
    2000-08-31      5
    2000-09-29      5
    2000-10-31      5
    2000-11-30      5
    2000-12-29      5
    2001-01-19     22
    2001-02-28    190
    2001-03-30    617
    2001-04-30    969
    2001-05-31    970
    2001-06-29    976
    2001-07-31    976
    2001-08-31    977
    2001-09-28    977
    2001-10-31    977
    2001-11-30    977
    2001-12-31    978
    2002-01-31    978
    Name: EP, dtype: int64
    日期
    2000-01-28     0
    2000-02-29     0
    2000-03-31     0
    2000-04-28     0
    2000-05-31     0
    2000-06-30     0
    2000-07-31     0
    2000-08-31     0
    2000-09-29     0
    2000-10-31     0
    2000-11-30     0
    2000-12-29     0
    2001-01-19     0
    2001-02-28     0
    2001-03-30     0
    2001-04-30     0
    2001-05-31     0
    2001-06-29     0
    2001-07-31     0
    2001-08-31     0
    2001-09-28     0
    2001-10-31     0
    2001-11-30     0
    2001-12-31    26
    2002-01-31    27
    Name: 毛利润资产比, dtype: int64
    日期
    2000-01-28     0
    2000-02-29     0
    2000-03-31     0
    2000-04-28     0
    2000-05-31     0
    2000-06-30     0
    2000-07-31     0
    2000-08-31     0
    2000-09-29     0
    2000-10-31     0
    2000-11-30     0
    2000-12-29     0
    2001-01-19     0
    2001-02-28     0
    2001-03-30     0
    2001-04-30     0
    2001-05-31     0
    2001-06-29     0
    2001-07-31     0
    2001-08-31     0
    2001-09-28     0
    2001-10-31     0
    2001-11-30     0
    2001-12-31    26
    2002-01-31    27
    Name: 应计利润, dtype: int64
    


```python
data2 = df_final_fill[df_final_fill.日期 > '2002-01-01'].copy()
```


```python
def get_qcut(s):
    return pd.qcut(s, q=10, labels=range(1, 11))

for col in yixiang_cols:
    print(col)
    data2[f'groupby_{col}'] = data2.groupby("日期")[col].apply(get_qcut)
```

    总资产增幅年
    销售费用/总资产
    EP
    毛利润资产比
    应计利润
    


```python
data2.columns
```




    Index(['证券名称', '证券代码', '日期', '1个月波动率', 'PE', '净经营现金流', '市现率', '总资产', '总资产增幅年',
           '收益率', '毛利', '营业利润', '销售费用', '销售费用/总资产', 'EP', '毛利润资产比', '应计利润',
           'groupby_总资产增幅年', 'groupby_销售费用/总资产', 'groupby_EP', 'groupby_毛利润资产比',
           'groupby_应计利润'],
          dtype='object')




```python
# 没有用
# test
_ = data2.groupby(['groupby_总资产增幅年', '日期'])['收益率'].mean()
new = _.unstack().T
newone = new[10] - new[1]
(newone / 100 + 1).cumprod().plot()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x26ce43521c0>




![png](6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_files/6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_28_1.png)



```python
# 累计收益率图
def get_cum_series(dat, group):
    _ = dat.groupby([group, '日期'])['收益率'].mean()
    new = _.unstack().T
    series = new[10] - new[1]
    cum_se = (series / 100 + 1).cumprod()
    cum_se.name = group
    return cum_se
```

## 用当期的变量进行分组画图


```python
groupby_cols = [f"groupby_{col}" for col in yixiang_cols]

for col in groupby_cols:
    plt.figure(figsize=(8, 4))
    _ = get_cum_series(data2, col)
    _.plot()
    plt.title(_.name)
```


![png](6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_files/6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_31_0.png)



![png](6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_files/6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_31_1.png)



![png](6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_files/6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_31_2.png)



![png](6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_files/6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_31_3.png)



![png](6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_files/6%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86%E5%8F%8A%E5%BC%82%E8%B1%A1_31_4.png)



```python
# for col in groupby_cols:
#     data2[f'{col}_lag1'] = data2.groupby("证券代码")[col].shift(1)
```


```python
# groupby_cols_lag = [f"groupby_{col}_lag1" for col in yixiang_cols]

# for col in groupby_cols:
#     plt.figure(figsize=(8, 4))
#     _ = get_cum_series(data2, col)
#     _.plot()
#     plt.title(_.name)
```


```python
data2.to_excel("全股票整理数据.xlsx", index=None)
```

## 分别对三个模型回归（回归方式与之前要求相同），对每组回归，分别输出 、 的t值、回归的R2、T个残差


```python
import statsmodels.api as sm

def get_OLS(X, y):
    X = sm.add_constant(X)
    mod = sm.OLS(y, X)
    res = mod.fit()
    return res
```


```python
# 每期收益率序列
def get_return_series(dat, group):
    _ = dat.groupby([group, '日期'])['收益率'].mean()
    new = _.unstack().T
    series = new[10] - new[1]
    series.name = group
    return series
```


```python
# 用上次的五因子数据和因子收益率数据
factor_df = pd.read_excel("上次数据/五因子数据.xlsx")
factor_df = factor_df.rename(columns={"时间" : "日期"})

factor_mut = pd.read_excel("上次数据/因子收益率.xlsx")
```


```python
# res.params.loc['const']
# res.tvalues.loc['const']
# res.resid
```

## 模型一


```python
len(groupby_cols)
```




    5



#### 建立表格来储存回归变量


```python
ai_list = []
ai_t_values_list = []
resid_df = pd.DataFrame()
```


```python
for group in groupby_cols:
    _ = get_return_series(data2, group)
    _ = _.reset_index().merge(factor_df, on='日期', how='left').dropna()
    X = _[['SMB', 'HML', 'CMA', 'RMW', 'mk_rf']]
    y = _[group]
    
    X.to_excel("模型1facotr.xlsx", index=None)

    res = get_OLS(X, y)
    print("异象的拟合方程：", group)
    print(res.summary())
    print("\n\n")
    
    const = res.params.loc['const']
    const_t_values = res.tvalues.loc['const']
    
    ai_list.append(['模型1', group, const])
    ai_t_values_list.append(['模型1', group, const_t_values])
    resid_df[f'模型1_{group}'] = res.resid
```

    异象的拟合方程： groupby_总资产增幅年
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:         groupby_总资产增幅年   R-squared:                       0.630
    Model:                            OLS   Adj. R-squared:                  0.621
    Method:                 Least Squares   F-statistic:                     71.46
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           2.00e-43
    Time:                        20:27:17   Log-Likelihood:                -487.63
    No. Observations:                 216   AIC:                             987.3
    Df Residuals:                     210   BIC:                             1008.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ==============================================================================
                     coef    std err          t      P>|t|      [0.025      0.975]
    ------------------------------------------------------------------------------
    const         -0.4444      0.177     -2.510      0.013      -0.794      -0.095
    SMB           -0.1264      0.053     -2.387      0.018      -0.231      -0.022
    HML            0.7226      0.094      7.704      0.000       0.538       0.908
    CMA            0.6215      0.108      5.768      0.000       0.409       0.834
    RMW           -0.1511      0.068     -2.216      0.028      -0.286      -0.017
    mk_rf          0.0672      0.018      3.727      0.000       0.032       0.103
    ==============================================================================
    Omnibus:                      116.268   Durbin-Watson:                   2.099
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):             1135.336
    Skew:                          -1.846   Prob(JB):                    2.92e-247
    Kurtosis:                      13.607   Cond. No.                         11.2
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_销售费用/总资产
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:       groupby_销售费用/总资产   R-squared:                       0.118
    Model:                            OLS   Adj. R-squared:                  0.097
    Method:                 Least Squares   F-statistic:                     5.624
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           6.90e-05
    Time:                        20:27:17   Log-Likelihood:                -656.46
    No. Observations:                 216   AIC:                             1325.
    Df Residuals:                     210   BIC:                             1345.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ==============================================================================
                     coef    std err          t      P>|t|      [0.025      0.975]
    ------------------------------------------------------------------------------
    const         -0.1927      0.387     -0.498      0.619      -0.955       0.570
    SMB            0.5367      0.116      4.639      0.000       0.309       0.765
    HML            0.3602      0.205      1.758      0.080      -0.044       0.764
    CMA           -0.0092      0.235     -0.039      0.969      -0.473       0.455
    RMW            0.0240      0.149      0.161      0.872      -0.270       0.318
    mk_rf         -0.0580      0.039     -1.473      0.142      -0.136       0.020
    ==============================================================================
    Omnibus:                       13.981   Durbin-Watson:                   2.128
    Prob(Omnibus):                  0.001   Jarque-Bera (JB):               36.963
    Skew:                          -0.102   Prob(JB):                     9.41e-09
    Kurtosis:                       5.016   Cond. No.                         11.2
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_EP
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:             groupby_EP   R-squared:                       0.658
    Model:                            OLS   Adj. R-squared:                  0.649
    Method:                 Least Squares   F-statistic:                     80.65
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           5.96e-47
    Time:                        20:27:17   Log-Likelihood:                -533.73
    No. Observations:                 216   AIC:                             1079.
    Df Residuals:                     210   BIC:                             1100.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ==============================================================================
                     coef    std err          t      P>|t|      [0.025      0.975]
    ------------------------------------------------------------------------------
    const          0.3056      0.219      1.394      0.165      -0.127       0.738
    SMB           -0.9663      0.066    -14.742      0.000      -1.096      -0.837
    HML            0.3272      0.116      2.818      0.005       0.098       0.556
    CMA           -0.1848      0.133     -1.385      0.167      -0.448       0.078
    RMW            0.5021      0.084      5.949      0.000       0.336       0.669
    mk_rf          0.0547      0.022      2.451      0.015       0.011       0.099
    ==============================================================================
    Omnibus:                        0.137   Durbin-Watson:                   2.155
    Prob(Omnibus):                  0.934   Jarque-Bera (JB):                0.027
    Skew:                          -0.020   Prob(JB):                        0.987
    Kurtosis:                       3.038   Cond. No.                         11.2
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_毛利润资产比
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:         groupby_毛利润资产比   R-squared:                       0.522
    Model:                            OLS   Adj. R-squared:                  0.511
    Method:                 Least Squares   F-statistic:                     45.91
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           6.56e-32
    Time:                        20:27:18   Log-Likelihood:                -619.60
    No. Observations:                 216   AIC:                             1251.
    Df Residuals:                     210   BIC:                             1271.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ==============================================================================
                     coef    std err          t      P>|t|      [0.025      0.975]
    ------------------------------------------------------------------------------
    const          0.1113      0.326      0.341      0.733      -0.532       0.754
    SMB           -0.0101      0.098     -0.103      0.918      -0.202       0.182
    HML            0.4610      0.173      2.668      0.008       0.120       0.802
    CMA           -0.1247      0.199     -0.628      0.530      -0.516       0.267
    RMW            0.9261      0.126      7.373      0.000       0.679       1.174
    mk_rf         -0.0598      0.033     -1.800      0.073      -0.125       0.006
    ==============================================================================
    Omnibus:                       78.042   Durbin-Watson:                   2.123
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):              467.237
    Skew:                          -1.251   Prob(JB):                    3.47e-102
    Kurtosis:                       9.757   Cond. No.                         11.2
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_应计利润
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:           groupby_应计利润   R-squared:                       0.485
    Model:                            OLS   Adj. R-squared:                  0.473
    Method:                 Least Squares   F-statistic:                     39.60
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.46e-28
    Time:                        20:27:18   Log-Likelihood:                -674.68
    No. Observations:                 216   AIC:                             1361.
    Df Residuals:                     210   BIC:                             1382.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ==============================================================================
                     coef    std err          t      P>|t|      [0.025      0.975]
    ------------------------------------------------------------------------------
    const          1.0641      0.421      2.528      0.012       0.234       1.894
    SMB           -1.1560      0.126     -9.182      0.000      -1.404      -0.908
    HML           -0.1213      0.223     -0.544      0.587      -0.561       0.318
    CMA           -0.0592      0.256     -0.231      0.817      -0.564       0.446
    RMW            0.8827      0.162      5.445      0.000       0.563       1.202
    mk_rf         -0.0911      0.043     -2.127      0.035      -0.176      -0.007
    ==============================================================================
    Omnibus:                       67.178   Durbin-Watson:                   2.593
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):              575.280
    Skew:                          -0.909   Prob(JB):                    1.20e-125
    Kurtosis:                      10.786   Cond. No.                         11.2
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    

## 模型二


```python
# group = groupby_cols[0]
# _ = get_return_series(data2, group)
# _ = _.reset_index().merge(factor_mut, on='日期', how='left').dropna()
```


```python
X_cols = ['市值因子收益率', '账面市值比因子收益率', 'ROE因子收益率', '总资产增长率因子收益率']
```


```python
for group in groupby_cols:
    _ = get_return_series(data2, group)
    _ = _.reset_index().merge(factor_mut, on='日期', how='left').dropna()
    
    X = _[X_cols]
    y = _[group] - _['const']
    
    X.to_excel("模型2facotr.xlsx", index=None)

    res = get_OLS(X, y)
    print("异象的拟合方程：", group)
    print(res.summary())
    print("\n\n")
    
    const = res.params.loc['const']
    const_t_values = res.tvalues.loc['const']
    
    ai_list.append(['模型2', group, const])
    ai_t_values_list.append(['模型2', group, const_t_values])
    resid_df[f'模型2_{group}'] = res.resid
```

    异象的拟合方程： groupby_总资产增幅年
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:                      y   R-squared:                       0.268
    Model:                            OLS   Adj. R-squared:                  0.254
    Method:                 Least Squares   F-statistic:                     19.29
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.53e-13
    Time:                        20:27:18   Log-Likelihood:                -770.27
    No. Observations:                 216   AIC:                             1551.
    Df Residuals:                     211   BIC:                             1567.
    Df Model:                           4                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -1.8354      0.659     -2.784      0.006      -3.135      -0.536
    市值因子收益率         1.8215      0.354      5.142      0.000       1.123       2.520
    账面市值比因子收益率      3.9602      0.640      6.193      0.000       2.700       5.221
    ROE因子收益率        0.8978      0.513      1.750      0.082      -0.114       1.909
    总资产增长率因子收益率     1.6539      0.373      4.433      0.000       0.918       2.389
    ==============================================================================
    Omnibus:                        4.443   Durbin-Watson:                   1.680
    Prob(Omnibus):                  0.108   Jarque-Bera (JB):                4.607
    Skew:                           0.204   Prob(JB):                       0.0999
    Kurtosis:                       3.587   Cond. No.                         2.43
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_销售费用/总资产
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:                      y   R-squared:                       0.123
    Model:                            OLS   Adj. R-squared:                  0.106
    Method:                 Least Squares   F-statistic:                     7.403
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.34e-05
    Time:                        20:27:18   Log-Likelihood:                -809.23
    No. Observations:                 216   AIC:                             1628.
    Df Residuals:                     211   BIC:                             1645.
    Df Model:                           4                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -0.4519      0.790     -0.572      0.568      -2.009       1.105
    市值因子收益率         0.7811      0.424      1.841      0.067      -0.055       1.617
    账面市值比因子收益率      3.5017      0.766      4.572      0.000       1.992       5.012
    ROE因子收益率        0.1941      0.614      0.316      0.752      -1.017       1.405
    总资产增长率因子收益率     1.1092      0.447      2.483      0.014       0.228       1.990
    ==============================================================================
    Omnibus:                        5.698   Durbin-Watson:                   1.901
    Prob(Omnibus):                  0.058   Jarque-Bera (JB):                7.905
    Skew:                          -0.117   Prob(JB):                       0.0192
    Kurtosis:                       3.908   Cond. No.                         2.43
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_EP
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:                      y   R-squared:                       0.318
    Model:                            OLS   Adj. R-squared:                  0.305
    Method:                 Least Squares   F-statistic:                     24.59
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.01e-16
    Time:                        20:27:19   Log-Likelihood:                -794.38
    No. Observations:                 216   AIC:                             1599.
    Df Residuals:                     211   BIC:                             1616.
    Df Model:                           4                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -3.2918      0.737     -4.465      0.000      -4.745      -1.839
    市值因子收益率         3.2968      0.396      8.324      0.000       2.516       4.078
    账面市值比因子收益率      3.5565      0.715      4.974      0.000       2.147       4.966
    ROE因子收益率        1.4632      0.574      2.551      0.011       0.332       2.594
    总资产增长率因子收益率     1.5850      0.417      3.800      0.000       0.763       2.407
    ==============================================================================
    Omnibus:                       14.527   Durbin-Watson:                   1.634
    Prob(Omnibus):                  0.001   Jarque-Bera (JB):               18.118
    Skew:                          -0.496   Prob(JB):                     0.000116
    Kurtosis:                       4.015   Cond. No.                         2.43
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_毛利润资产比
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:                      y   R-squared:                       0.271
    Model:                            OLS   Adj. R-squared:                  0.258
    Method:                 Least Squares   F-statistic:                     19.65
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           9.20e-14
    Time:                        20:27:19   Log-Likelihood:                -816.69
    No. Observations:                 216   AIC:                             1643.
    Df Residuals:                     211   BIC:                             1660.
    Df Model:                           4                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -1.3060      0.817     -1.598      0.112      -2.917       0.305
    市值因子收益率         2.2089      0.439      5.030      0.000       1.343       3.075
    账面市值比因子收益率      4.6261      0.793      5.835      0.000       3.063       6.189
    ROE因子收益率        2.5853      0.636      4.065      0.000       1.331       3.839
    总资产增长率因子收益率     2.1602      0.463      4.671      0.000       1.249       3.072
    ==============================================================================
    Omnibus:                        8.002   Durbin-Watson:                   1.823
    Prob(Omnibus):                  0.018   Jarque-Bera (JB):                8.550
    Skew:                          -0.354   Prob(JB):                       0.0139
    Kurtosis:                       3.669   Cond. No.                         2.43
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_应计利润
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:                      y   R-squared:                       0.302
    Model:                            OLS   Adj. R-squared:                  0.289
    Method:                 Least Squares   F-statistic:                     22.81
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.13e-15
    Time:                        20:27:19   Log-Likelihood:                -840.10
    No. Observations:                 216   AIC:                             1690.
    Df Residuals:                     211   BIC:                             1707.
    Df Model:                           4                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -3.1477      0.911     -3.455      0.001      -4.944      -1.352
    市值因子收益率         4.0171      0.489      8.208      0.000       3.052       4.982
    账面市值比因子收益率      3.6172      0.884      4.094      0.000       1.875       5.359
    ROE因子收益率        1.9524      0.709      2.754      0.006       0.555       3.350
    总资产增长率因子收益率     2.2340      0.515      4.334      0.000       1.218       3.250
    ==============================================================================
    Omnibus:                       46.578   Durbin-Watson:                   1.961
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):              136.992
    Skew:                          -0.891   Prob(JB):                     1.79e-30
    Kurtosis:                       6.470   Cond. No.                         2.43
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    

## 模型三


```python
X_cols_03 = ['mk_rf', '市值因子收益率', '账面市值比因子收益率', 'ROE因子收益率', '总资产增长率因子收益率']
```


```python
for group in groupby_cols:
    _ = get_return_series(data2, group)
    _ = _.reset_index().merge(factor_mut, on='日期', how='left').merge(factor_df, on='日期', how='left').dropna()
    
    X = _[X_cols_03]
    y = _[group]
    
    X.to_excel("模型3facotr.xlsx", index=None)

    res = get_OLS(X, y)
    print("异象的拟合方程：", group)
    print(res.summary())
    print("\n\n")
    
    const = res.params.loc['const']
    const_t_values = res.tvalues.loc['const']
    
    ai_list.append(['模型3', group, const])
    ai_t_values_list.append(['模型3', group, const_t_values])
    resid_df[f'模型3_{group}'] = res.resid
```

    异象的拟合方程： groupby_总资产增幅年
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:         groupby_总资产增幅年   R-squared:                       0.353
    Model:                            OLS   Adj. R-squared:                  0.338
    Method:                 Least Squares   F-statistic:                     22.94
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           2.36e-18
    Time:                        20:27:19   Log-Likelihood:                -547.89
    No. Observations:                 216   AIC:                             1108.
    Df Residuals:                     210   BIC:                             1128.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -0.4111      0.238     -1.726      0.086      -0.881       0.058
    mk_rf           0.0873      0.024      3.713      0.000       0.041       0.134
    市值因子收益率         0.4414      0.132      3.333      0.001       0.180       0.703
    账面市值比因子收益率      1.6741      0.238      7.040      0.000       1.205       2.143
    ROE因子收益率        1.1840      0.184      6.446      0.000       0.822       1.546
    总资产增长率因子收益率     0.8513      0.136      6.255      0.000       0.583       1.120
    ==============================================================================
    Omnibus:                        7.086   Durbin-Watson:                   1.859
    Prob(Omnibus):                  0.029   Jarque-Bera (JB):                8.184
    Skew:                          -0.281   Prob(JB):                       0.0167
    Kurtosis:                       3.771   Cond. No.                         12.3
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_销售费用/总资产
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:       groupby_销售费用/总资产   R-squared:                       0.119
    Model:                            OLS   Adj. R-squared:                  0.098
    Method:                 Least Squares   F-statistic:                     5.687
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           6.08e-05
    Time:                        20:27:19   Log-Likelihood:                -656.32
    No. Observations:                 216   AIC:                             1325.
    Df Residuals:                     210   BIC:                             1345.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const           1.1301      0.393      2.872      0.004       0.354       1.906
    mk_rf          -0.0300      0.039     -0.772      0.441      -0.107       0.047
    市值因子收益率        -0.7899      0.219     -3.610      0.000      -1.221      -0.359
    账面市值比因子收益率      0.8950      0.393      2.278      0.024       0.121       1.669
    ROE因子收益率        0.4864      0.303      1.603      0.110      -0.112       1.085
    总资产增长率因子收益率     0.1758      0.225      0.782      0.435      -0.267       0.619
    ==============================================================================
    Omnibus:                       13.630   Durbin-Watson:                   2.202
    Prob(Omnibus):                  0.001   Jarque-Bera (JB):               36.598
    Skew:                           0.037   Prob(JB):                     1.13e-08
    Kurtosis:                       5.015   Cond. No.                         12.3
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_EP
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:             groupby_EP   R-squared:                       0.476
    Model:                            OLS   Adj. R-squared:                  0.463
    Method:                 Least Squares   F-statistic:                     38.09
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.00e-27
    Time:                        20:27:20   Log-Likelihood:                -579.75
    No. Observations:                 216   AIC:                             1172.
    Df Residuals:                     210   BIC:                             1192.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -1.7291      0.276     -6.264      0.000      -2.273      -1.185
    mk_rf          -0.0157      0.027     -0.576      0.565      -0.069       0.038
    市值因子收益率         1.7491      0.154     11.393      0.000       1.446       2.052
    账面市值比因子收益率      0.9888      0.276      3.588      0.000       0.445       1.532
    ROE因子收益率        1.7548      0.213      8.243      0.000       1.335       2.174
    总资产增长率因子收益率     0.6676      0.158      4.232      0.000       0.357       0.979
    ==============================================================================
    Omnibus:                       37.114   Durbin-Watson:                   2.171
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):               92.009
    Skew:                          -0.760   Prob(JB):                     1.05e-20
    Kurtosis:                       5.813   Cond. No.                         12.3
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_毛利润资产比
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:         groupby_毛利润资产比   R-squared:                       0.450
    Model:                            OLS   Adj. R-squared:                  0.437
    Method:                 Least Squares   F-statistic:                     34.33
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.45e-25
    Time:                        20:27:20   Log-Likelihood:                -634.85
    No. Observations:                 216   AIC:                             1282.
    Df Residuals:                     210   BIC:                             1302.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const           0.3586      0.356      1.007      0.315      -0.344       1.061
    mk_rf          -0.0915      0.035     -2.603      0.010      -0.161      -0.022
    市值因子收益率         0.5378      0.198      2.715      0.007       0.147       0.928
    账面市值比因子收益率      1.8512      0.356      5.205      0.000       1.150       2.552
    ROE因子收益率        2.8809      0.275     10.486      0.000       2.339       3.423
    总资产增长率因子收益率     1.1582      0.204      5.689      0.000       0.757       1.560
    ==============================================================================
    Omnibus:                      102.369   Durbin-Watson:                   2.064
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):             1027.524
    Skew:                          -1.544   Prob(JB):                    7.52e-224
    Kurtosis:                      13.229   Cond. No.                         12.3
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    异象的拟合方程： groupby_应计利润
                                OLS Regression Results                            
    ==============================================================================
    Dep. Variable:           groupby_应计利润   R-squared:                       0.410
    Model:                            OLS   Adj. R-squared:                  0.396
    Method:                 Least Squares   F-statistic:                     29.20
    Date:                Thu, 12 Aug 2021   Prob (F-statistic):           1.88e-22
    Time:                        20:27:20   Log-Likelihood:                -689.41
    No. Observations:                 216   AIC:                             1391.
    Df Residuals:                     210   BIC:                             1411.
    Df Model:                           5                                         
    Covariance Type:            nonrobust                                         
    ===============================================================================
                      coef    std err          t      P>|t|      [0.025      0.975]
    -------------------------------------------------------------------------------
    const          -1.3725      0.459     -2.993      0.003      -2.277      -0.468
    mk_rf          -0.1738      0.045     -3.839      0.000      -0.263      -0.085
    市值因子收益率         2.2121      0.255      8.673      0.000       1.709       2.715
    账面市值比因子收益率      0.6175      0.458      1.348      0.179      -0.285       1.520
    ROE因子收益率        2.2523      0.354      6.368      0.000       1.555       2.950
    总资产增长率因子收益率     1.1402      0.262      4.350      0.000       0.624       1.657
    ==============================================================================
    Omnibus:                       73.217   Durbin-Watson:                   2.554
    Prob(Omnibus):                  0.000   Jarque-Bera (JB):              668.467
    Skew:                          -1.003   Prob(JB):                    6.98e-146
    Kurtosis:                      11.381   Cond. No.                         12.3
    ==============================================================================
    
    Notes:
    [1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
    
    
    
    


```python
ai_df = pd.DataFrame(ai_list, columns = ['模型号', '异象变量', 'const'])
ai_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>模型号</th>
      <th>异象变量</th>
      <th>const</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>模型1</td>
      <td>groupby_总资产增幅年</td>
      <td>-0.444437</td>
    </tr>
    <tr>
      <th>1</th>
      <td>模型1</td>
      <td>groupby_销售费用/总资产</td>
      <td>-0.192677</td>
    </tr>
    <tr>
      <th>2</th>
      <td>模型1</td>
      <td>groupby_EP</td>
      <td>0.305626</td>
    </tr>
    <tr>
      <th>3</th>
      <td>模型1</td>
      <td>groupby_毛利润资产比</td>
      <td>0.111312</td>
    </tr>
    <tr>
      <th>4</th>
      <td>模型1</td>
      <td>groupby_应计利润</td>
      <td>1.064129</td>
    </tr>
    <tr>
      <th>5</th>
      <td>模型2</td>
      <td>groupby_总资产增幅年</td>
      <td>-1.835419</td>
    </tr>
    <tr>
      <th>6</th>
      <td>模型2</td>
      <td>groupby_销售费用/总资产</td>
      <td>-0.451875</td>
    </tr>
    <tr>
      <th>7</th>
      <td>模型2</td>
      <td>groupby_EP</td>
      <td>-3.291832</td>
    </tr>
    <tr>
      <th>8</th>
      <td>模型2</td>
      <td>groupby_毛利润资产比</td>
      <td>-1.306030</td>
    </tr>
    <tr>
      <th>9</th>
      <td>模型2</td>
      <td>groupby_应计利润</td>
      <td>-3.147731</td>
    </tr>
    <tr>
      <th>10</th>
      <td>模型3</td>
      <td>groupby_总资产增幅年</td>
      <td>-0.411097</td>
    </tr>
    <tr>
      <th>11</th>
      <td>模型3</td>
      <td>groupby_销售费用/总资产</td>
      <td>1.130059</td>
    </tr>
    <tr>
      <th>12</th>
      <td>模型3</td>
      <td>groupby_EP</td>
      <td>-1.729093</td>
    </tr>
    <tr>
      <th>13</th>
      <td>模型3</td>
      <td>groupby_毛利润资产比</td>
      <td>0.358593</td>
    </tr>
    <tr>
      <th>14</th>
      <td>模型3</td>
      <td>groupby_应计利润</td>
      <td>-1.372544</td>
    </tr>
  </tbody>
</table>
</div>




```python
ai_t_values_df = pd.DataFrame(ai_t_values_list, columns = ['模型号', '异象变量', 'const_tvalues'])
ai_t_values_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>模型号</th>
      <th>异象变量</th>
      <th>const_tvalues</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>模型1</td>
      <td>groupby_总资产增幅年</td>
      <td>-2.509785</td>
    </tr>
    <tr>
      <th>1</th>
      <td>模型1</td>
      <td>groupby_销售费用/总资产</td>
      <td>-0.497974</td>
    </tr>
    <tr>
      <th>2</th>
      <td>模型1</td>
      <td>groupby_EP</td>
      <td>1.394238</td>
    </tr>
    <tr>
      <th>3</th>
      <td>模型1</td>
      <td>groupby_毛利润资产比</td>
      <td>0.341228</td>
    </tr>
    <tr>
      <th>4</th>
      <td>模型1</td>
      <td>groupby_应计利润</td>
      <td>2.527730</td>
    </tr>
    <tr>
      <th>5</th>
      <td>模型2</td>
      <td>groupby_总资产增幅年</td>
      <td>-2.783569</td>
    </tr>
    <tr>
      <th>6</th>
      <td>模型2</td>
      <td>groupby_销售费用/总资产</td>
      <td>-0.572212</td>
    </tr>
    <tr>
      <th>7</th>
      <td>模型2</td>
      <td>groupby_EP</td>
      <td>-4.465003</td>
    </tr>
    <tr>
      <th>8</th>
      <td>模型2</td>
      <td>groupby_毛利润资产比</td>
      <td>-1.597654</td>
    </tr>
    <tr>
      <th>9</th>
      <td>模型2</td>
      <td>groupby_应计利润</td>
      <td>-3.455147</td>
    </tr>
    <tr>
      <th>10</th>
      <td>模型3</td>
      <td>groupby_总资产增幅年</td>
      <td>-1.726062</td>
    </tr>
    <tr>
      <th>11</th>
      <td>模型3</td>
      <td>groupby_销售费用/总资产</td>
      <td>2.872083</td>
    </tr>
    <tr>
      <th>12</th>
      <td>模型3</td>
      <td>groupby_EP</td>
      <td>-6.264071</td>
    </tr>
    <tr>
      <th>13</th>
      <td>模型3</td>
      <td>groupby_毛利润资产比</td>
      <td>1.006624</td>
    </tr>
    <tr>
      <th>14</th>
      <td>模型3</td>
      <td>groupby_应计利润</td>
      <td>-2.992840</td>
    </tr>
  </tbody>
</table>
</div>




```python
print(resid_df.columns)
```

    Index(['模型1_groupby_总资产增幅年', '模型1_groupby_销售费用/总资产', '模型1_groupby_EP',
           '模型1_groupby_毛利润资产比', '模型1_groupby_应计利润', '模型2_groupby_总资产增幅年',
           '模型2_groupby_销售费用/总资产', '模型2_groupby_EP', '模型2_groupby_毛利润资产比',
           '模型2_groupby_应计利润', '模型3_groupby_总资产增幅年', '模型3_groupby_销售费用/总资产',
           '模型3_groupby_EP', '模型3_groupby_毛利润资产比', '模型3_groupby_应计利润'],
          dtype='object')
    


```python
resid_df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>模型1_groupby_总资产增幅年</th>
      <th>模型1_groupby_销售费用/总资产</th>
      <th>模型1_groupby_EP</th>
      <th>模型1_groupby_毛利润资产比</th>
      <th>模型1_groupby_应计利润</th>
      <th>模型2_groupby_总资产增幅年</th>
      <th>模型2_groupby_销售费用/总资产</th>
      <th>模型2_groupby_EP</th>
      <th>模型2_groupby_毛利润资产比</th>
      <th>模型2_groupby_应计利润</th>
      <th>模型3_groupby_总资产增幅年</th>
      <th>模型3_groupby_销售费用/总资产</th>
      <th>模型3_groupby_EP</th>
      <th>模型3_groupby_毛利润资产比</th>
      <th>模型3_groupby_应计利润</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.005866</td>
      <td>-5.282117</td>
      <td>0.356122</td>
      <td>-4.327000</td>
      <td>3.865597</td>
      <td>19.635442</td>
      <td>9.421270</td>
      <td>14.874280</td>
      <td>9.776161</td>
      <td>19.678814</td>
      <td>6.605060</td>
      <td>-5.281996</td>
      <td>0.374755</td>
      <td>-5.804763</td>
      <td>2.924384</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-2.253227</td>
      <td>3.407555</td>
      <td>-2.081074</td>
      <td>5.607356</td>
      <td>-16.002521</td>
      <td>-4.960343</td>
      <td>1.210197</td>
      <td>-2.197771</td>
      <td>5.232255</td>
      <td>-15.612233</td>
      <td>-3.422341</td>
      <td>2.950871</td>
      <td>-0.481780</td>
      <td>7.079259</td>
      <td>-13.623058</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.341921</td>
      <td>-3.620564</td>
      <td>-2.828131</td>
      <td>-0.326422</td>
      <td>-0.196136</td>
      <td>-7.150400</td>
      <td>-10.950722</td>
      <td>-7.513647</td>
      <td>-5.456481</td>
      <td>-4.583299</td>
      <td>-1.292994</td>
      <td>-4.314569</td>
      <td>-0.972338</td>
      <td>1.588231</td>
      <td>3.007693</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-2.842416</td>
      <td>-2.373290</td>
      <td>-2.303783</td>
      <td>-1.621151</td>
      <td>-9.022625</td>
      <td>-7.839451</td>
      <td>-6.374202</td>
      <td>-4.861234</td>
      <td>-4.086278</td>
      <td>-11.726189</td>
      <td>-4.310901</td>
      <td>-2.395853</td>
      <td>-0.937666</td>
      <td>0.128054</td>
      <td>-7.196329</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.527729</td>
      <td>-6.754487</td>
      <td>-2.275293</td>
      <td>-4.946632</td>
      <td>-3.103228</td>
      <td>12.449516</td>
      <td>6.138225</td>
      <td>11.172548</td>
      <td>7.761561</td>
      <td>12.418026</td>
      <td>0.531325</td>
      <td>-7.393015</td>
      <td>-2.162237</td>
      <td>-6.615944</td>
      <td>-3.091012</td>
    </tr>
  </tbody>
</table>
</div>




```python
ai_df.to_excel('alpha表格.xlsx', index=None)
ai_t_values_df.to_excel('t_values表格.xlsx', index=None)
resid_df.to_excel('残差表格.xlsx', index=None)
```


```python

```


```python

```
