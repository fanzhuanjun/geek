```python
import numpy as np
import pandas as pd
import os
```


```python
dat = pd.read_excel("75个投资组合.xlsx")
```


```python
factor_df = pd.read_excel("五因子数据.xlsx")
factor_df = factor_df.rename(columns={"时间" : "日期"})
```


```python
factor_df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>日期</th>
      <th>SMB</th>
      <th>HML</th>
      <th>CMA</th>
      <th>RMW</th>
      <th>mk_rf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-07-31</td>
      <td>1.776700</td>
      <td>-2.048085</td>
      <td>-3.020902</td>
      <td>-3.910493</td>
      <td>4.985</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-08-31</td>
      <td>2.161310</td>
      <td>-3.355225</td>
      <td>-2.356352</td>
      <td>-3.563212</td>
      <td>0.555</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-09-29</td>
      <td>2.768764</td>
      <td>-0.595435</td>
      <td>-0.795055</td>
      <td>-0.294096</td>
      <td>-3.895</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-10-31</td>
      <td>2.368923</td>
      <td>0.203406</td>
      <td>-1.691315</td>
      <td>-2.593286</td>
      <td>3.545</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-11-30</td>
      <td>0.514857</td>
      <td>0.213481</td>
      <td>0.095284</td>
      <td>-0.527789</td>
      <td>6.015</td>
    </tr>
  </tbody>
</table>
</div>




```python
dat = dat.merge(factor_df[['日期', 'mk_rf']], on='日期')
```


```python
dat.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 17550 entries, 0 to 17549
    Data columns (total 16 columns):
     #   Column                  Non-Null Count  Dtype         
    ---  ------                  --------------  -----         
     0   日期                      17550 non-null  datetime64[ns]
     1   投资组合                    17550 non-null  object        
     2   收益率                     17550 non-null  float64       
     3   收益率_rf                  17550 non-null  float64       
     4   市值_winsorized_lag1      17550 non-null  float64       
     5   账面市值比_winsorized_lag1   17550 non-null  float64       
     6   ROE_winsorized_lag1     17550 non-null  float64       
     7   总资产增长率_winsorized_lag1  17550 non-null  float64       
     8   const                   17550 non-null  float64       
     9   市值因子收益率                 17550 non-null  float64       
     10  账面市值比因子收益率              17550 non-null  float64       
     11  ROE因子收益率                17550 non-null  float64       
     12  总资产增长率因子收益率             17550 non-null  float64       
     13  预期收益率                   17550 non-null  float64       
     14  超额alpha                 17550 non-null  float64       
     15  mk_rf                   17550 non-null  float64       
    dtypes: datetime64[ns](1), float64(14), object(1)
    memory usage: 2.3+ MB
    


```python
import statsmodels.api as sm

def get_OLS(X, y):
    X = sm.add_constant(X)
    mod = sm.OLS(y, X)
    res = mod.fit()
    return res
```


```python
X = dat[['市值因子收益率', '账面市值比因子收益率', 'ROE因子收益率', '总资产增长率因子收益率', 'mk_rf']]
y = dat['收益率_rf']
```


```python
get_OLS(X, y).summary()
```




<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>收益率_rf</td>      <th>  R-squared:         </th> <td>   0.885</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.885</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>2.699e+04</td>
</tr>
<tr>
  <th>Date:</th>             <td>Thu, 12 Aug 2021</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>12:45:39</td>     <th>  Log-Likelihood:    </th> <td> -46220.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td> 17550</td>      <th>  AIC:               </th> <td>9.245e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 17544</td>      <th>  BIC:               </th> <td>9.250e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     5</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
       <td></td>          <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>       <td>    0.2266</td> <td>    0.029</td> <td>    7.930</td> <td> 0.000</td> <td>    0.171</td> <td>    0.283</td>
</tr>
<tr>
  <th>市值因子收益率</th>     <td>   -0.0169</td> <td>    0.016</td> <td>   -1.027</td> <td> 0.304</td> <td>   -0.049</td> <td>    0.015</td>
</tr>
<tr>
  <th>账面市值比因子收益率</th>  <td>   -0.0033</td> <td>    0.028</td> <td>   -0.118</td> <td> 0.906</td> <td>   -0.059</td> <td>    0.052</td>
</tr>
<tr>
  <th>ROE因子收益率</th>    <td>    0.1558</td> <td>    0.022</td> <td>    7.185</td> <td> 0.000</td> <td>    0.113</td> <td>    0.198</td>
</tr>
<tr>
  <th>总资产增长率因子收益率</th> <td>   -0.0195</td> <td>    0.017</td> <td>   -1.152</td> <td> 0.249</td> <td>   -0.053</td> <td>    0.014</td>
</tr>
<tr>
  <th>mk_rf</th>       <td>    0.9716</td> <td>    0.003</td> <td>  337.502</td> <td> 0.000</td> <td>    0.966</td> <td>    0.977</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>20314.387</td> <th>  Durbin-Watson:     </th>   <td>   1.421</td>  
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>   <th>  Jarque-Bera (JB):  </th> <td>17301317.585</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 5.295</td>   <th>  Prob(JB):          </th>   <td>    0.00</td>  
</tr>
<tr>
  <th>Kurtosis:</th>       <td>156.453</td>  <th>  Cond. No.          </th>   <td>    11.8</td>  
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.




```python

```
