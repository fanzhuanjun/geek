```python
import tushare as ts
import numpy as np
import pandas as pd
```


```python
# load data
def get_return(code):
    df = ts.get_k_data(code, start='2001-01-01', end='2021-07-15')
    df.date = pd.to_datetime(df.date)
    return df

benchmark_ret=get_return('sh')
```

    本接口即将停止更新，请尽快使用Pro版接口：https://tushare.pro/document/2



```python
benchmark_ret['return'] = benchmark_ret['close'].pct_change()
```


```python
benchmark_ret.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
      <th>return</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2001-01-02</td>
      <td>2077.08</td>
      <td>2103.47</td>
      <td>2103.54</td>
      <td>2074.88</td>
      <td>18650700.0</td>
      <td>sh</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2001-01-03</td>
      <td>2108.25</td>
      <td>2123.90</td>
      <td>2123.90</td>
      <td>2105.50</td>
      <td>17157700.0</td>
      <td>sh</td>
      <td>0.009713</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2001-01-04</td>
      <td>2125.49</td>
      <td>2117.41</td>
      <td>2127.42</td>
      <td>2113.18</td>
      <td>13425000.0</td>
      <td>sh</td>
      <td>-0.003056</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2001-01-05</td>
      <td>2117.66</td>
      <td>2125.30</td>
      <td>2125.38</td>
      <td>2114.06</td>
      <td>13289000.0</td>
      <td>sh</td>
      <td>0.003726</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2001-01-08</td>
      <td>2128.60</td>
      <td>2102.06</td>
      <td>2131.98</td>
      <td>2092.10</td>
      <td>14787100.0</td>
      <td>sh</td>
      <td>-0.010935</td>
    </tr>
  </tbody>
</table>
</div>




```python
inter = pd.read_excel("c:/我的研究/降准分析/人民币存款准备金率.xls").dropna()
inter.columns
```




    Index(['指标名称', '人民币存款准备金率：大型存款类金融机构（公告日期）'], dtype='object')




```python
inter['降准变化'] = inter['人民币存款准备金率：大型存款类金融机构（公告日期）'].diff()
```


```python
inter.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>指标名称</th>
      <th>人民币存款准备金率：大型存款类金融机构（公告日期）</th>
      <th>降准变化</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>47</th>
      <td>2018-10-07</td>
      <td>14.5</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>48</th>
      <td>2019-01-04</td>
      <td>13.5</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>2019-09-06</td>
      <td>13.0</td>
      <td>-0.5</td>
    </tr>
    <tr>
      <th>50</th>
      <td>2020-01-01</td>
      <td>12.5</td>
      <td>-0.5</td>
    </tr>
    <tr>
      <th>51</th>
      <td>2021-07-09</td>
      <td>12.0</td>
      <td>-0.5</td>
    </tr>
  </tbody>
</table>
</div>




```python
benchmark_ret = benchmark_ret.reset_index()
```


```python
date = pd.to_datetime("2021-01-01")
```


```python

```




    Timestamp('2021-01-02 00:00:00')




```python
# index_target = 
_ = date
while benchmark_ret[benchmark_ret['date'] == _].shape[0] == 0:
    _ += pd.offsets.Day(1)
target_date = _
```


```python
target_index = benchmark_ret[benchmark_ret['date'] == target_date].index[0]
q, h = target_index-5, target_index+5
```


```python

```


```python
list_result = []
for i in range(1, 52):
    date = inter.loc[i, '指标名称']
    print(date)
    io = inter.loc[i, '降准变化']
    print("准备金率变化:", io)
    
    _ = pd.to_datetime(date)
    while benchmark_ret[benchmark_ret['date'] == _].shape[0] == 0:
        _ += pd.offsets.Day(1)
    target_date = _
    target_index = benchmark_ret[benchmark_ret['date'] == target_date].index[0]
    q, h = target_index-5, target_index+5
    t_0_10 = benchmark_ret.loc[h].close / benchmark_ret.loc[q].close - 1
    t_0_5 = benchmark_ret.loc[target_index].close / benchmark_ret.loc[q].close - 1
    t_5_10 = benchmark_ret.loc[h].close / benchmark_ret.loc[target_index].close - 1
    print("t[-5, 5]:", round(t_0_10, 4)*100, "%")
    print("t[-5, 0]:", round(t_0_5, 4)*100, "%")
    print("t[0, 5]:", round(t_5_10, 4)*100, "%")
    list_result.append([date, io, t_0_10, t_0_5, t_5_10])
```

    2003-08-23
    准备金率变化: 1.0
    t[-5, 5]: 0.33 %
    t[-5, 0]: -1.59 %
    t[0, 5]: 1.94 %
    2004-04-12
    准备金率变化: 0.5
    t[-5, 5]: -5.13 %
    t[-5, 0]: -2.46 %
    t[0, 5]: -2.73 %
    2006-06-16
    准备金率变化: 0.5
    t[-5, 5]: 3.5000000000000004 %
    t[-5, 0]: 1.49 %
    t[0, 5]: 1.9800000000000002 %
    2006-07-21
    准备金率变化: 0.5
    t[-5, 5]: -0.19 %
    t[-5, 0]: 0.01 %
    t[0, 5]: -0.2 %
    2006-11-03
    准备金率变化: 0.5
    t[-5, 5]: 4.21 %
    t[-5, 0]: 3.27 %
    t[0, 5]: 0.91 %
    2007-01-05
    准备金率变化: 0.5
    t[-5, 5]: 7.6 %
    t[-5, 0]: 6.52 %
    t[0, 5]: 1.01 %
    2007-02-16
    准备金率变化: 0.5
    t[-5, 5]: 3.6999999999999997 %
    t[-5, 0]: 9.82 %
    t[0, 5]: -5.57 %
    2007-04-05
    准备金率变化: 0.5
    t[-5, 5]: 10.43 %
    t[-5, 0]: 3.8 %
    t[0, 5]: 6.38 %
    2007-04-29
    准备金率变化: 0.5
    t[-5, 5]: 9.04 %
    t[-5, 0]: 3.51 %
    t[0, 5]: 5.34 %
    2007-05-18
    准备金率变化: 0.5
    t[-5, 5]: 3.93 %
    t[-5, 0]: 0.21 %
    t[0, 5]: 3.71 %
    2007-07-30
    准备金率变化: 0.5
    t[-5, 5]: 9.84 %
    t[-5, 0]: 5.4 %
    t[0, 5]: 4.22 %
    2007-09-06
    准备金率变化: 0.5
    t[-5, 5]: 2.0500000000000003 %
    t[-5, 0]: 4.37 %
    t[0, 5]: -2.23 %
    2007-10-13
    准备金率变化: 0.5
    t[-5, 5]: -0.44999999999999996 %
    t[-5, 0]: 5.93 %
    t[0, 5]: -6.02 %
    2007-11-10
    准备金率变化: 0.5
    t[-5, 5]: -6.47 %
    t[-5, 0]: -7.93 %
    t[0, 5]: 1.58 %
    2007-12-08
    准备金率变化: 1.0
    t[-5, 5]: 0.16999999999999998 %
    t[-5, 0]: 6.02 %
    t[0, 5]: -5.52 %
    2008-01-16
    准备金率变化: 0.5
    t[-5, 5]: -13.48 %
    t[-5, 0]: -2.67 %
    t[0, 5]: -11.110000000000001 %
    2008-03-18
    准备金率变化: 0.5
    t[-5, 5]: -12.870000000000001 %
    t[-5, 0]: -11.93 %
    t[0, 5]: -1.0699999999999998 %
    2008-04-16
    准备金率变化: 0.5
    t[-5, 5]: -3.9699999999999998 %
    t[-5, 0]: -3.58 %
    t[0, 5]: -0.4 %
    2008-05-12
    准备金率变化: 0.5
    t[-5, 5]: -4.15 %
    t[-5, 0]: -3.56 %
    t[0, 5]: -0.61 %
    2008-06-07
    准备金率变化: 1.0
    t[-5, 5]: -19.2 %
    t[-5, 0]: -11.18 %
    t[0, 5]: -9.030000000000001 %
    2008-09-15
    准备金率变化: 0.0
    t[-5, 5]: 2.71 %
    t[-5, 0]: -7.31 %
    t[0, 5]: 10.82 %
    2008-10-08
    准备金率变化: -0.5
    t[-5, 5]: -10.02 %
    t[-5, 0]: -5.62 %
    t[0, 5]: -4.66 %
    2008-11-26
    准备金率变化: -1.0
    t[-5, 5]: -2.58 %
    t[-5, 0]: -5.93 %
    t[0, 5]: 3.56 %
    2008-12-22
    准备金率变化: -0.5
    t[-5, 5]: -5.800000000000001 %
    t[-5, 0]: 1.1900000000000002 %
    t[0, 5]: -6.909999999999999 %
    2010-01-12
    准备金率变化: 0.5
    t[-5, 5]: -1.08 %
    t[-5, 0]: -0.25 %
    t[0, 5]: -0.83 %
    2010-02-12
    准备金率变化: 0.5
    t[-5, 5]: 3.83 %
    t[-5, 0]: 2.68 %
    t[0, 5]: 1.1199999999999999 %
    2010-05-02
    准备金率变化: 0.5
    t[-5, 5]: -10.84 %
    t[-5, 0]: -4.52 %
    t[0, 5]: -6.619999999999999 %
    2010-11-10
    准备金率变化: 0.5
    t[-5, 5]: -6.34 %
    t[-5, 0]: 2.78 %
    t[0, 5]: -8.88 %
    2010-11-19
    准备金率变化: 0.5
    t[-5, 5]: -3.81 %
    t[-5, 0]: -3.2399999999999998 %
    t[0, 5]: -0.58 %
    2010-12-10
    准备金率变化: 0.5
    t[-5, 5]: 1.81 %
    t[-5, 0]: -0.05 %
    t[0, 5]: 1.8499999999999999 %
    2011-01-14
    准备金率变化: 0.5
    t[-5, 5]: -4.35 %
    t[-5, 0]: -1.67 %
    t[0, 5]: -2.7199999999999998 %
    2011-02-18
    准备金率变化: 0.5
    t[-5, 5]: 1.81 %
    t[-5, 0]: 2.56 %
    t[0, 5]: -0.73 %
    2011-03-18
    准备金率变化: 0.5
    t[-5, 5]: 1.5 %
    t[-5, 0]: -0.9199999999999999 %
    t[0, 5]: 2.44 %
    2011-04-17
    准备金率变化: 0.5
    t[-5, 5]: -1.91 %
    t[-5, 0]: 1.1400000000000001 %
    t[0, 5]: -3.02 %
    2011-05-12
    准备金率变化: 0.5
    t[-5, 5]: -0.44999999999999996 %
    t[-5, 0]: -0.9900000000000001 %
    t[0, 5]: 0.54 %
    2011-06-14
    准备金率变化: 0.5
    t[-5, 5]: -3.56 %
    t[-5, 0]: -0.52 %
    t[0, 5]: -3.06 %
    2011-11-30
    准备金率变化: -0.5
    t[-5, 5]: -2.6 %
    t[-5, 0]: -2.5700000000000003 %
    t[0, 5]: -0.03 %
    2012-02-18
    准备金率变化: -0.5
    t[-5, 5]: 4.05 %
    t[-5, 0]: 0.5 %
    t[0, 5]: 3.53 %
    2012-05-12
    准备金率变化: -0.5
    t[-5, 5]: -4.2299999999999995 %
    t[-5, 0]: -2.9000000000000004 %
    t[0, 5]: -1.3599999999999999 %
    2015-02-04
    准备金率变化: -0.5
    t[-5, 5]: -4.4799999999999995 %
    t[-5, 0]: -3.9800000000000004 %
    t[0, 5]: -0.52 %
    2015-04-19
    准备金率变化: -1.0
    t[-5, 5]: 9.84 %
    t[-5, 0]: 2.31 %
    t[0, 5]: 7.359999999999999 %
    2015-08-25
    准备金率变化: -0.5
    t[-5, 5]: -15.52 %
    t[-5, 0]: -20.9 %
    t[0, 5]: 6.800000000000001 %
    2015-10-23
    准备金率变化: -0.5
    t[-5, 5]: -0.26 %
    t[-5, 0]: 0.62 %
    t[0, 5]: -0.88 %
    2016-02-29
    准备金率变化: -0.5
    t[-5, 5]: -1.02 %
    t[-5, 0]: -8.17 %
    t[0, 5]: 7.79 %
    2018-04-17
    准备金率变化: -1.0
    t[-5, 5]: -1.92 %
    t[-5, 0]: -3.8699999999999997 %
    t[0, 5]: 2.03 %
    2018-06-24
    准备金率变化: -0.5
    t[-5, 5]: -8.15 %
    t[-5, 0]: -5.38 %
    t[0, 5]: -2.93 %
    2018-10-07
    准备金率变化: -1.0
    t[-5, 5]: -8.200000000000001 %
    t[-5, 0]: -2.8899999999999997 %
    t[0, 5]: -5.46 %
    2019-01-04
    准备金率变化: -1.0
    t[-5, 5]: 2.22 %
    t[-5, 0]: 0.66 %
    t[0, 5]: 1.55 %
    2019-09-06
    准备金率变化: -0.5
    t[-5, 5]: 5.01 %
    t[-5, 0]: 3.93 %
    t[0, 5]: 1.04 %
    2020-01-01
    准备金率变化: -0.5
    t[-5, 5]: 3.7900000000000005 %
    t[-5, 0]: 3.46 %
    t[0, 5]: 0.31 %
    2021-07-09
    准备金率变化: -0.5

```python
df_result = pd.DataFrame(list_result, columns=['date', '准备金率变化', '0_10', '0_5', '5_10'])
```


```python
df_result['dumm'] = df_result['准备金率变化'].apply(lambda x: 1 if x<0 else 0)
```


```python
df_result.corr()
```



<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>准备金率变化</th>
      <th>0_10</th>
      <th>0_5</th>
      <th>5_10</th>
      <th>dumm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>准备金率变化</th>
      <td>1.000000</td>
      <td>0.015529</td>
      <td>0.220493</td>
      <td>-0.251611</td>
      <td>-0.945299</td>
    </tr>
    <tr>
      <th>0_10</th>
      <td>0.015529</td>
      <td>1.000000</td>
      <td>0.739853</td>
      <td>0.566760</td>
      <td>-0.101323</td>
    </tr>
    <tr>
      <th>0_5</th>
      <td>0.220493</td>
      <td>0.739853</td>
      <td>1.000000</td>
      <td>-0.133101</td>
      <td>-0.246702</td>
    </tr>
    <tr>
      <th>5_10</th>
      <td>-0.251611</td>
      <td>0.566760</td>
      <td>-0.133101</td>
      <td>1.000000</td>
      <td>0.156241</td>
    </tr>
    <tr>
      <th>dumm</th>
      <td>-0.945299</td>
      <td>-0.101323</td>
      <td>-0.246702</td>
      <td>0.156241</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>



```python
from pyecharts.charts import Bar
from pyecharts.faker import Faker
from pyecharts.globals import ThemeType
def make_plot(list_0, list_1):
    c = (
        Bar({"theme": ThemeType.MACARONS})
        .add_xaxis(['【-5：5】', '【-5：0】', '【0：5】'])
        .add_yaxis("降准", list_0)
        .add_yaxis("升准", list_1)
        .set_global_opts(
            title_opts={"text": "事件内累计sh收益率"}
        )).render_notebook()
    return c
```


```python
_ = df_result.groupby('dumm')[['0_10', '0_5', '5_10']].mean()
_
```



<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0_10</th>
      <th>0_5</th>
      <th>5_10</th>
    </tr>
    <tr>
      <th>dumm</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.009636</td>
      <td>-0.001471</td>
      <td>-0.008205</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.023451</td>
      <td>-0.029140</td>
      <td>0.006599</td>
    </tr>
  </tbody>
</table>



```python
l1 = ['{:.4f}'.format(i) for i in list(_.loc[0].values)]
l2 = ['{:.4f}'.format(i) for i in list(_.loc[1].values)]

```


```python
make_plot(l2, l1)
```


```python
li = [
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801010.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801020.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801030.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801040.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801050.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801080.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801110.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801120.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801130.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801140.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801150.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801160.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801170.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801180.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801200.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801210.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801230.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801710.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801720.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801730.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801740.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801750.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801760.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801770.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801780.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801790.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801880.SWI.csv",
    "C:/我的研究/降准分析/行业指数/逐股输出（指数）_801890.SWI.csv",
]
```


```python
def get_result(data, date_col='date', close_col='close', num=5):
    list_result = []
    for i in range(1, 51):
        date = inter.loc[i, '指标名称']
        io = inter.loc[i, '降准变化']

        _ = pd.to_datetime(date)
        while data[data[date_col] == _].shape[0] == 0:
            _ += pd.offsets.Day(1)
        target_date = _
        target_index = data[data[date_col] == target_date].index[0]
        q, h = target_index-num, target_index+num
        # print(q, h)
        t_0_10 = data.loc[h, close_col] / data.loc[q, close_col] - 1
        t_0_5 = data.loc[target_index, close_col] / data.loc[q, close_col] - 1
        t_5_10 = data.loc[h, close_col] / data.loc[target_index, close_col] - 1
        list_result.append([date, io, t_0_10, t_0_5, t_5_10])
    final_data = pd.DataFrame(list_result, columns=['date', '准备金率变化', '0_10', '0_5', '5_10'])
    
    final_data['行业'] = data.loc[0, '简称'].replace("(申万)", "")
    return final_data
```


```python

```


```python

```


```python
d0.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 5219 entries, 0 to 5218
    Data columns (total 7 columns):
     #   Column  Non-Null Count  Dtype         
    ---  ------  --------------  -----         
     0   代码      5219 non-null   object        
     1   简称      5219 non-null   object        
     2   时间      5219 non-null   datetime64[ns]
     3   开盘价(元)  5219 non-null   float64       
     4   收盘价(元)  5219 non-null   float64       
     5   最高价(元)  5219 non-null   float64       
     6   最低价(元)  5219 non-null   float64       
    dtypes: datetime64[ns](1), float64(4), object(2)
    memory usage: 285.5+ KB



```python
d0['最低价(元)'].astype("float")
```




    0       1000.000
    1        985.470
    2       1013.070
    3       1011.000
    4       1058.830
              ...   
    5214    3472.080
    5215    3477.538
    5216    3489.507
    5217    3487.905
    5218    3454.372
    Name: 最低价(元), Length: 5219, dtype: float64




```python
d0.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>代码</th>
      <th>简称</th>
      <th>时间</th>
      <th>开盘价(元)</th>
      <th>收盘价(元)</th>
      <th>最高价(元)</th>
      <th>最低价(元)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>801010.SWI</td>
      <td>农林牧渔(申万)</td>
      <td>1999-12-30</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
      <td>1000.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>801010.SWI</td>
      <td>农林牧渔(申万)</td>
      <td>2000-01-04</td>
      <td>1001.98</td>
      <td>1027.66</td>
      <td>1035.36</td>
      <td>985.47</td>
    </tr>
    <tr>
      <th>2</th>
      <td>801010.SWI</td>
      <td>农林牧渔(申万)</td>
      <td>2000-01-05</td>
      <td>1035.47</td>
      <td>1028.87</td>
      <td>1057.85</td>
      <td>1013.07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>801010.SWI</td>
      <td>农林牧渔(申万)</td>
      <td>2000-01-06</td>
      <td>1025.38</td>
      <td>1065.67</td>
      <td>1070.79</td>
      <td>1011.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>801010.SWI</td>
      <td>农林牧渔(申万)</td>
      <td>2000-01-07</td>
      <td>1076.06</td>
      <td>1106.19</td>
      <td>1117.71</td>
      <td>1058.83</td>
    </tr>
  </tbody>
</table>



```python
g_df = pd.DataFrame()
for i in range(len(li)):
    d0 = pd.read_csv(li[i], encoding='gbk', thousands=',')
    d0['时间'] = pd.to_datetime(d0['时间'])
    _ = get_result(d0, date_col='时间', close_col='收盘价(元)', num=10)
    print("done 1.")
    g_df = g_df.append(_)
```

    done 1.
    done 1.



```python
g_df['dumm'] = g_df['准备金率变化'].apply(lambda x: 1 if x<0 else 0)
```


```python
import matplotlib.pyplot as plt

# 中文乱码
plt.rcParams['font.sans-serif']=['SimHei'] #用来正常显示中文标签
plt.rcParams['axes.unicode_minus']=False #用来正常显示负号

```


```python
_ =  g_df.groupby(['dumm', '行业'])[['0_10', '0_5', '5_10']].mean()
# _.plot.bar(figsize=(13, 9))
```


```python
_.loc[1].sort_values("5_10").plot.bar(figsize=(15, 9))
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2279f164790>




![png](%E9%99%8D%E5%87%86%E5%88%86%E6%9E%90_files/%E9%99%8D%E5%87%86%E5%88%86%E6%9E%90_35_1.png)



```python
_.loc[1].sort_values("0_10").plot.bar(figsize=(15, 9))
```




    <matplotlib.axes._subplots.AxesSubplot at 0x2279edabee0>




![png](%E9%99%8D%E5%87%86%E5%88%86%E6%9E%90_files/%E9%99%8D%E5%87%86%E5%88%86%E6%9E%90_36_1.png)



```python
from pyecharts import options as opts
from pyecharts.charts import Funnel
from pyecharts.faker import Faker

c = (
    Funnel()
    .add("商品", [list(z) for z in zip(Faker.choose(), Faker.values())])
    .set_global_opts(title_opts=opts.TitleOpts(title="Funnel-基本示例"))
    .render_notebook()
)
c
```
